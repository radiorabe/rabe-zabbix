# Zabbix Template: Apache by HTTP

![class: software](https://img.shields.io/badge/class-software-00c9bf)![target: apache](https://img.shields.io/badge/target-apache-00c9bf)![vendor: Zabbix](https://img.shields.io/badge/vendor-Zabbix-00c9bf)![version: 6.4-0](https://img.shields.io/badge/version-6.4--0-00c9bf)

Get metrics from mod_status module using HTTP agent.
https://httpd.apache.org/docs/current/mod/mod_status.html

You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback/384764-discussion-thread-for-official-zabbix-template-apache

Generated by official Zabbix template tool "Templator"

## Changes

These changes are part of [RaBe's Zabbix template and helpers
collection](https://github.com/radiorabe/rabe-zabbix).

* Added `{$APACHE.STATUS.HOST}` instead of `{HOST.NAME}` for agentless use


## Items

### Item: Apache: Total bytes

![component: network](https://img.shields.io/badge/component-network-00c9bf)

The total bytes served.

```
apache.bytes
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| Value type | FLOAT in B |
| History | 7d |
| Source item | `apache.get_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| JSONPATH | `["$[\"Total kBytes\"]"]` |
| MULTIPLIER | `["1024"]` |

### Item: Apache: Bytes per second

![component: network](https://img.shields.io/badge/component-network-00c9bf)

It is calculated as a rate of change for total bytes statistics.
`BytesPerSec` is not used, as it counts the average since the last Apache server start.


```
apache.bytes.rate
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| Value type | FLOAT in Bps |
| History | 7d |
| Source item | `apache.get_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| JSONPATH | `["$[\"Total kBytes\"]"]` |
| MULTIPLIER | `["1024"]` |
| CHANGE_PER_SECOND | `[""]` |

### Item: Apache: Get status

![component: raw](https://img.shields.io/badge/component-raw-00c9bf)

Getting data from a machine-readable version of the Apache status page.
For more information see Apache Module [mod_status](https://httpd.apache.org/docs/current/mod/mod_status.html).


```
apache.get_status
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | HTTP_AGENT |
| Value type | TEXT |
| History | 1h |

### Item: Apache: Total requests

![component: network](https://img.shields.io/badge/component-network-00c9bf)

The total number of the Apache server accesses.

```
apache.requests
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| History | 7d |
| Source item | `apache.get_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| JSONPATH | `["$[\"Total Accesses\"]"]` |

### Item: Apache: Requests per second

![component: network](https://img.shields.io/badge/component-network-00c9bf)

It is calculated as a rate of change for the "Total requests" statistics.
`ReqPerSec` is not used, as it counts the average since the last Apache server start.


```
apache.requests.rate
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| Value type | FLOAT |
| History | 7d |
| Source item | `apache.get_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| JSONPATH | `["$[\"Total Accesses\"]"]` |
| CHANGE_PER_SECOND | `[""]` |

### Item: Apache: Uptime

![component: system](https://img.shields.io/badge/component-system-00c9bf)

The service uptime expressed in seconds.

```
apache.uptime
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| History | 7d |
| Source item | `apache.get_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| JSONPATH | `["$.ServerUptimeSeconds"]` |

### Item: Apache: Version

![component: system](https://img.shields.io/badge/component-system-00c9bf)

The Apache service version.

```
apache.version
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| Value type | CHAR |
| History | 7d |
| Source item | `apache.get_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| JSONPATH | `["$.ServerVersion"]` |
| DISCARD_UNCHANGED_HEARTBEAT | `["1d"]` |

### Item: Apache: Workers idle cleanup

![component: system](https://img.shields.io/badge/component-system-00c9bf)

The number of workers in cleanup state.

```
apache.workers.cleanup
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| History | 7d |
| Source item | `apache.get_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| JSONPATH | `["$.Workers.cleanup"]` |

### Item: Apache: Workers closing connection

![component: system](https://img.shields.io/badge/component-system-00c9bf)

The number of workers in closing state.

```
apache.workers.closing
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| History | 7d |
| Source item | `apache.get_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| JSONPATH | `["$.Workers.closing"]` |

### Item: Apache: Workers DNS lookup

![component: system](https://img.shields.io/badge/component-system-00c9bf)

The number of workers in `dnslookup` state.

```
apache.workers.dnslookup
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| History | 7d |
| Source item | `apache.get_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| JSONPATH | `["$.Workers.dnslookup"]` |

### Item: Apache: Workers finishing

![component: system](https://img.shields.io/badge/component-system-00c9bf)

The number of workers in finishing state.

```
apache.workers.finishing
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| History | 7d |
| Source item | `apache.get_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| JSONPATH | `["$.Workers.finishing"]` |

### Item: Apache: Workers keepalive (read)

![component: system](https://img.shields.io/badge/component-system-00c9bf)

The number of workers in `keepalive` state.

```
apache.workers.keepalive
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| History | 7d |
| Source item | `apache.get_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| JSONPATH | `["$.Workers.keepalive"]` |

### Item: Apache: Workers logging

![component: system](https://img.shields.io/badge/component-system-00c9bf)

The number of workers in logging state.

```
apache.workers.logging
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| History | 7d |
| Source item | `apache.get_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| JSONPATH | `["$.Workers.logging"]` |

### Item: Apache: Workers reading request

![component: system](https://img.shields.io/badge/component-system-00c9bf)

The number of workers in reading state.

```
apache.workers.reading
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| History | 7d |
| Source item | `apache.get_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| JSONPATH | `["$.Workers.reading"]` |

### Item: Apache: Workers sending reply

![component: system](https://img.shields.io/badge/component-system-00c9bf)

The number of workers in sending state.

```
apache.workers.sending
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| History | 7d |
| Source item | `apache.get_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| JSONPATH | `["$.Workers.sending"]` |

### Item: Apache: Workers slot with no current process

![component: system](https://img.shields.io/badge/component-system-00c9bf)

The number of slots with no current process.

```
apache.workers.slot
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| History | 7d |
| Source item | `apache.get_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| JSONPATH | `["$.Workers.slot"]` |

### Item: Apache: Workers starting up

![component: system](https://img.shields.io/badge/component-system-00c9bf)

The number of workers in starting state.

```
apache.workers.starting
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| History | 7d |
| Source item | `apache.get_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| JSONPATH | `["$.Workers.starting"]` |

### Item: Apache: Workers waiting for connection

![component: system](https://img.shields.io/badge/component-system-00c9bf)

The number of workers in waiting state.

```
apache.workers.waiting
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| History | 7d |
| Source item | `apache.get_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| JSONPATH | `["$.Workers.waiting"]` |

### Item: Apache: Total workers busy

![component: system](https://img.shields.io/badge/component-system-00c9bf)

The total number of busy worker threads/processes.

```
apache.workers_total.busy
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| History | 7d |
| Source item | `apache.get_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| JSONPATH | `["$.BusyWorkers"]` |

### Item: Apache: Total workers idle

![component: system](https://img.shields.io/badge/component-system-00c9bf)

The total number of idle worker threads/processes.

```
apache.workers_total.idle
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| History | 7d |
| Source item | `apache.get_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| JSONPATH | `["$.IdleWorkers"]` |

### Item: Apache: Service response time

![component: application](https://img.shields.io/badge/component-application-00c9bf)![component: health](https://img.shields.io/badge/component-health-00c9bf)



```
net.tcp.service.perf[http,"{$APACHE.STATUS.HOST}","{$APACHE.STATUS.PORT}"]
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | SIMPLE |
| Value type | FLOAT in s |
| History | 7d |

### Item: Apache: Service ping

![component: application](https://img.shields.io/badge/component-application-00c9bf)![component: health](https://img.shields.io/badge/component-health-00c9bf)



```
net.tcp.service[http,"{$APACHE.STATUS.HOST}","{$APACHE.STATUS.PORT}"]
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | SIMPLE |
| History | 7d |

## Triggers

### Trigger: Apache: Failed to fetch status page

![scope: availability](https://img.shields.io/badge/scope-availability-00c9bf)

Zabbix has not received any data for items for the last 30 minutes.
Settings:

| Trigger Setting | Values |
| --------------- | ------ |
| Priority | WARNING |
| Manual close | YES |

```
nodata(/Apache by HTTP/apache.get_status,30m)=1
```

### Trigger: Apache: Host has been restarted

![scope: notice](https://img.shields.io/badge/scope-notice-00c9bf)

Uptime is less than 10 minutes.
Settings:

| Trigger Setting | Values |
| --------------- | ------ |
| Priority | INFO |
| Manual close | YES |

```
last(/Apache by HTTP/apache.uptime)<10m
```

### Trigger: Apache: Version has changed

![scope: notice](https://img.shields.io/badge/scope-notice-00c9bf)

Apache version has changed. Acknowledge to close the problem manually.
Settings:

| Trigger Setting | Values |
| --------------- | ------ |
| Priority | INFO |
| Manual close | YES |

```
last(/Apache by HTTP/apache.version,#1)<>last(/Apache by HTTP/apache.version,#2) and length(last(/Apache by HTTP/apache.version))>0
```

### Trigger: Apache: Service response time is too high

![scope: performance](https://img.shields.io/badge/scope-performance-00c9bf)


Settings:

| Trigger Setting | Values |
| --------------- | ------ |
| Priority | WARNING |
| Manual close | YES |

```
min(/Apache by HTTP/net.tcp.service.perf[http,"{$APACHE.STATUS.HOST}","{$APACHE.STATUS.PORT}"],5m)>{$APACHE.RESPONSE_TIME.MAX.WARN}
```

### Trigger: Apache: Service is down

![scope: availability](https://img.shields.io/badge/scope-availability-00c9bf)


Settings:

| Trigger Setting | Values |
| --------------- | ------ |
| Priority | AVERAGE |
| Manual close | YES |

```
last(/Apache by HTTP/net.tcp.service[http,"{$APACHE.STATUS.HOST}","{$APACHE.STATUS.PORT}"])=0
```

## Discovery Rules

### Discovery Rule: Event MPM discovery

The discovery of additional metrics if the event Multi-Processing Module (MPM) is used.
For more details see [Apache MPM event](https://httpd.apache.org/docs/current/mod/event.html).

```
apache.mpm.event.discovery
```
Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| Source item | `apache.get_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| JAVASCRIPT | `["return JSON.stringify(JSON.parse(value).ServerMPM === 'event'\n\t? [{'{#SINGLETON}': ''}] : []);\n"]` |
| DISCARD_UNCHANGED_HEARTBEAT | `["3h"]` |

#### Discovery Rule: Event MPM discovery: Item Prototypes

##### Discovery Rule: Event MPM discovery: Item Prototype: Apache: Bytes per request

![component: connection](https://img.shields.io/badge/component-connection-00c9bf)

The average number of client requests per second.

```
apache.bytes[per_request{#SINGLETON}]
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| Value type | FLOAT in B |
| History | 7d |
| Source item | `apache.get_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| JSONPATH | `["$.BytesPerReq"]` |

##### Discovery Rule: Event MPM discovery: Item Prototype: Apache: Connections async closing

![component: connection](https://img.shields.io/badge/component-connection-00c9bf)

The number of asynchronous connections in closing state (applicable only to the event MPM).

```
apache.connections[async_closing{#SINGLETON}]
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| History | 7d |
| Source item | `apache.get_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| JSONPATH | `["$.ConnsAsyncClosing"]` |

##### Discovery Rule: Event MPM discovery: Item Prototype: Apache: Connections async keepalive

![component: connection](https://img.shields.io/badge/component-connection-00c9bf)

The number of asynchronous connections in keepalive state (applicable only to the event MPM).

```
apache.connections[async_keep_alive{#SINGLETON}]
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| History | 7d |
| Source item | `apache.get_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| JSONPATH | `["$.ConnsAsyncKeepAlive"]` |

##### Discovery Rule: Event MPM discovery: Item Prototype: Apache: Connections async writing

![component: connection](https://img.shields.io/badge/component-connection-00c9bf)

The number of asynchronous connections in writing state (applicable only to the event MPM).

```
apache.connections[async_writing{#SINGLETON}]
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| History | 7d |
| Source item | `apache.get_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| JSONPATH | `["$.ConnsAsyncWriting"]` |

##### Discovery Rule: Event MPM discovery: Item Prototype: Apache: Connections total

![component: connection](https://img.shields.io/badge/component-connection-00c9bf)

The number of total connections.

```
apache.connections[total{#SINGLETON}]
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| History | 7d |
| Source item | `apache.get_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| JSONPATH | `["$.ConnsTotal"]` |

##### Discovery Rule: Event MPM discovery: Item Prototype: Apache: Number of async processes

![component: system](https://img.shields.io/badge/component-system-00c9bf)

The number of asynchronous processes.

```
apache.process[num{#SINGLETON}]
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| History | 7d |
| Source item | `apache.get_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| JSONPATH | `["$.Processes"]` |

#### Discovery Rule: Event MPM discovery: Graph Prototypes

The following graph prototypes are defined by this Template

* Apache: Current async connections{#SINGLETON}
* Apache: Current async processes{#SINGLETON}


## Macros

The following Zabbix macros are configured via this template.

### Macro: `{$APACHE.RESPONSE_TIME.MAX.WARN}`

The maximum Apache response time expressed in seconds for a trigger expression.

Default:
```
10
```

### Macro: `{$APACHE.STATUS.HOST}`

Hostname or IP of Apache HTTP server

Default:
```
127.0.0.1
```

### Macro: `{$APACHE.STATUS.PATH}`

The URL path.

Default:
```
server-status?auto
```

### Macro: `{$APACHE.STATUS.PORT}`

The port of the Apache status page.

Default:
```
80
```

### Macro: `{$APACHE.STATUS.SCHEME}`

The request scheme, which may be either HTTP or HTTPS.

Default:
```
http
```

## Dashboards

The following Zabbix dashboards are included in this template.

* Apache performance
