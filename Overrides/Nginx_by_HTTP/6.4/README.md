# Zabbix Template: Nginx by HTTP

![class: software](https://img.shields.io/badge/class-software-00c9bf) ![target: nginx](https://img.shields.io/badge/target-nginx-00c9bf) ![vendor: Zabbix](https://img.shields.io/badge/vendor-Zabbix-00c9bf) ![version: 6.4-0](https://img.shields.io/badge/version-6.4--0-00c9bf)

Get metrics from stub status module using HTTP agent
https://nginx.ru/en/docs/http/ngx_http_stub_status_module.html.

You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback/384765-discussion-thread-for-official-zabbix-template-nginx

Generated by official Zabbix template tool "Templator"

## Changes

These changes are part of [RaBe's Zabbix template and helpers
collection](https://github.com/radiorabe/rabe-zabbix).

* Added `{$NGINX.STUB_STATUS.HOST}` instead of `{HOST.NAME}` for agentless use

## Items

### Item: Nginx: Service response time

![component: application](https://img.shields.io/badge/component-application-00c9bf) ![component: health](https://img.shields.io/badge/component-health-00c9bf)



```console
net.tcp.service.perf[http,"{$NGINX.STUB_STATUS.HOST}","{$NGINX.STUB_STATUS.PORT}"]
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | SIMPLE |
| Value type | FLOAT in s |
| History | 7d |

### Item: Nginx: Service status

![component: application](https://img.shields.io/badge/component-application-00c9bf) ![component: health](https://img.shields.io/badge/component-health-00c9bf)



```console
net.tcp.service[http,"{$NGINX.STUB_STATUS.HOST}","{$NGINX.STUB_STATUS.PORT}"]
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | SIMPLE |
| History | 7d |

### Item: Nginx: Connections accepted per second

![component: connections](https://img.shields.io/badge/component-connections-00c9bf)

The total number of accepted client connections.

```console
nginx.connections.accepted.rate
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| Value type | FLOAT |
| History | 7d |
| Source item | `nginx.get_stub_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| REGEX | `["server accepts handled requests\\s+([0-9]+) ([0-9]+) ([0-9]+)", "\\1"]` |
| CHANGE_PER_SECOND | `[""]` |

### Item: Nginx: Connections active

![component: connections](https://img.shields.io/badge/component-connections-00c9bf)

The current number of active client connections including waiting connections.

```console
nginx.connections.active
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| History | 7d |
| Source item | `nginx.get_stub_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| REGEX | `["Active connections: ([0-9]+)", "\\1"]` |

### Item: Nginx: Connections dropped per second

![component: connections](https://img.shields.io/badge/component-connections-00c9bf)

The total number of dropped client connections.

```console
nginx.connections.dropped.rate
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| Value type | FLOAT |
| History | 7d |
| Source item | `nginx.get_stub_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| JAVASCRIPT | `["var a = value.match(/server accepts handled requests\\s+([0-9]+) ([0-9]+) ([0-9]+)/)\nif (a) {\n\treturn a[1]-a[2]\n}\n"]` |
| CHANGE_PER_SECOND | `[""]` |

### Item: Nginx: Connections handled per second

![component: connections](https://img.shields.io/badge/component-connections-00c9bf)

The total number of handled connections. Generally, the parameter value is the same as for the accepted connections, unless some resource limits have been reached (for example, the `worker_connections limit`).

```console
nginx.connections.handled.rate
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| Value type | FLOAT |
| History | 7d |
| Source item | `nginx.get_stub_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| REGEX | `["server accepts handled requests\\s+([0-9]+) ([0-9]+) ([0-9]+)", "\\2"]` |
| CHANGE_PER_SECOND | `[""]` |

### Item: Nginx: Connections reading

![component: connections](https://img.shields.io/badge/component-connections-00c9bf)

The current number of connections where Nginx is reading the request header.

```console
nginx.connections.reading
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| History | 7d |
| Source item | `nginx.get_stub_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| REGEX | `["Reading: ([0-9]+) Writing: ([0-9]+) Waiting: ([0-9]+)", "\\1"]` |

### Item: Nginx: Connections waiting

![component: connections](https://img.shields.io/badge/component-connections-00c9bf)

The current number of idle client connections waiting for a request.

```console
nginx.connections.waiting
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| History | 7d |
| Source item | `nginx.get_stub_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| REGEX | `["Reading: ([0-9]+) Writing: ([0-9]+) Waiting: ([0-9]+)", "\\3"]` |

### Item: Nginx: Connections writing

![component: connections](https://img.shields.io/badge/component-connections-00c9bf)

The current number of connections where Nginx is writing a response back to the client.

```console
nginx.connections.writing
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| History | 7d |
| Source item | `nginx.get_stub_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| REGEX | `["Reading: ([0-9]+) Writing: ([0-9]+) Waiting: ([0-9]+)", "\\2"]` |

### Item: Nginx: Get stub status page

![component: application](https://img.shields.io/badge/component-application-00c9bf) ![component: health](https://img.shields.io/badge/component-health-00c9bf)

The following status information is provided:
`Active connections` - the current number of active client connections including waiting connections.
`Accepted` - the total number of accepted client connections.
`Handled` - the total number of handled connections. Generally, the parameter value is the same as for the accepted connections, unless some resource limits have been reached (for example, the `worker_connections` limit).
`Requests` - the total number of client requests.
`Reading` - the current number of connections where Nginx is reading the request header.
`Writing` - the current number of connections where Nginx is writing a response back to the client.
`Waiting` - the current number of idle client connections waiting for a request.

See also [Module ngx_http_stub_status_module](https://nginx.org/en/docs/http/ngx_http_stub_status_module.html).

```console
nginx.get_stub_status
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | HTTP_AGENT |
| Value type | TEXT |
| History | 1h |

### Item: Nginx: Requests total

![component: requests](https://img.shields.io/badge/component-requests-00c9bf)

The total number of client requests.

```console
nginx.requests.total
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| History | 7d |
| Source item | `nginx.get_stub_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| REGEX | `["server accepts handled requests\\s+([0-9]+) ([0-9]+) ([0-9]+)", "\\3"]` |

### Item: Nginx: Requests per second

![component: requests](https://img.shields.io/badge/component-requests-00c9bf)

The total number of client requests.

```console
nginx.requests.total.rate
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| Value type | FLOAT |
| History | 7d |
| Source item | `nginx.get_stub_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| REGEX | `["server accepts handled requests\\s+([0-9]+) ([0-9]+) ([0-9]+)", "\\3"]` |
| CHANGE_PER_SECOND | `[""]` |

### Item: Nginx: Version

![component: application](https://img.shields.io/badge/component-application-00c9bf)



```console
nginx.version
```

Settings:

| Item Setting | Value |
| ------------ | ----- |
| Type | DEPENDENT |
| Value type | CHAR |
| History | 7d |
| Source item | `nginx.get_stub_status` |

Preprocessing steps:

| Type | Parameters |
| ---- | ---------- |
| REGEX | `["(?i)Server: nginx\\/(.+(?<!\\r))", "\\1"]` |
| DISCARD_UNCHANGED_HEARTBEAT | `["1d"]` |

## Triggers

### Trigger: Nginx: Service response time is too high

![scope: performance](https://img.shields.io/badge/scope-performance-00c9bf)


Settings:

| Trigger Setting | Values |
| --------------- | ------ |
| Priority | WARNING |
| Manual close | YES |

```console
min(/Nginx by HTTP/net.tcp.service.perf[http,"{$NGINX.STUB_STATUS.HOST}","{$NGINX.STUB_STATUS.PORT}"],5m)>{$NGINX.RESPONSE_TIME.MAX.WARN}
```

### Trigger: Nginx: Service is down

![scope: availability](https://img.shields.io/badge/scope-availability-00c9bf)


Settings:

| Trigger Setting | Values |
| --------------- | ------ |
| Priority | AVERAGE |
| Manual close | YES |

```console
last(/Nginx by HTTP/net.tcp.service[http,"{$NGINX.STUB_STATUS.HOST}","{$NGINX.STUB_STATUS.PORT}"])=0
```

### Trigger: Nginx: High connections drop rate

![scope: performance](https://img.shields.io/badge/scope-performance-00c9bf)

The rate of dropping connections has been greater than {$NGINX.DROP_RATE.MAX.WARN} for the last 5 minutes.
Settings:

| Trigger Setting | Values |
| --------------- | ------ |
| Priority | WARNING |

```console
min(/Nginx by HTTP/nginx.connections.dropped.rate,5m) > {$NGINX.DROP_RATE.MAX.WARN}
```

### Trigger: Nginx: Failed to fetch stub status page

![scope: availability](https://img.shields.io/badge/scope-availability-00c9bf)

Zabbix has not received any data for items for the last 30 minutes.
Settings:

| Trigger Setting | Values |
| --------------- | ------ |
| Priority | WARNING |
| Manual close | YES |

```console
find(/Nginx by HTTP/nginx.get_stub_status,,"iregexp","HTTP\/[\d.]+\s+200")=0 or
nodata(/Nginx by HTTP/nginx.get_stub_status,30m)=1

```

### Trigger: Nginx: Version has changed

![scope: notice](https://img.shields.io/badge/scope-notice-00c9bf)

The Nginx version has changed. Acknowledge to close the problem manually.
Settings:

| Trigger Setting | Values |
| --------------- | ------ |
| Priority | INFO |
| Manual close | YES |

```console
last(/Nginx by HTTP/nginx.version,#1)<>last(/Nginx by HTTP/nginx.version,#2) and length(last(/Nginx by HTTP/nginx.version))>0
```

## Macros

The following Zabbix macros are configured via this template.

### Macro: `{$NGINX.DROP_RATE.MAX.WARN}`

The critical rate of the dropped connections for a trigger expression.

Default:

```console
1
```

### Macro: `{$NGINX.RESPONSE_TIME.MAX.WARN}`

The maximum response time of Nginx expressed in seconds for a trigger expression.

Default:

```console
10
```

### Macro: `{$NGINX.STUB_STATUS.HOST}`

Hostname or IP of Nginx HTTP server

Default:

```console
127.0.0.1
```

### Macro: `{$NGINX.STUB_STATUS.PATH}`

The path of the `Nginx stub_status` page.

Default:

```console
basic_status
```

### Macro: `{$NGINX.STUB_STATUS.PORT}`

The port of the `Nginx stub_status` host or container.

Default:

```console
80
```

### Macro: `{$NGINX.STUB_STATUS.SCHEME}`

The protocol http or https of Nginx stub_status host or container.

Default:

```console
http
```

## Dashboards

The following Zabbix dashboards are included in this template.

* Nginx performance
