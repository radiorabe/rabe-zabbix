# Compare Rabe Override with Upstream Template

Original: [Nginx by HTTP](https://raw.githubusercontent.com/zabbix/zabbix/release/6.4/templates/app/nginx_http/template_app_nginx_http.yaml)

## Diff

```diff
--- before
+++ after
@@ -14,6 +14,13 @@
         You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback/384765-discussion-thread-for-official-zabbix-template-nginx
         
         Generated by official Zabbix template tool "Templator"
+        
+        ## Changes
+        
+        These changes are part of [RaBe's Zabbix template and helpers
+        collection](https://github.com/radiorabe/rabe-zabbix).
+        
+        * Added `{$NGINX.STUB_STATUS.HOST}` instead of `{HOST.NAME}` for agentless use
       vendor:
         name: Zabbix
         version: 6.4-0
@@ -23,7 +30,7 @@
         - uuid: 18c6209295b347e2a96ef11b147139d8
           name: 'Nginx: Service response time'
           type: SIMPLE
-          key: 'net.tcp.service.perf[http,"{HOST.CONN}","{$NGINX.STUB_STATUS.PORT}"]'
+          key: 'net.tcp.service.perf[http,"{$NGINX.STUB_STATUS.HOST}","{$NGINX.STUB_STATUS.PORT}"]'
           history: 7d
           value_type: FLOAT
           units: s
@@ -34,21 +41,21 @@
               value: health
           triggers:
             - uuid: fc1f7927b8864996986c1da44df57279
-              expression: 'min(/Nginx by HTTP/net.tcp.service.perf[http,"{HOST.CONN}","{$NGINX.STUB_STATUS.PORT}"],5m)>{$NGINX.RESPONSE_TIME.MAX.WARN}'
+              expression: 'min(/Nginx by HTTP/net.tcp.service.perf[http,"{$NGINX.STUB_STATUS.HOST}","{$NGINX.STUB_STATUS.PORT}"],5m)>{$NGINX.RESPONSE_TIME.MAX.WARN}'
               name: 'Nginx: Service response time is too high'
               event_name: 'Nginx: Service response time is too high (over {$NGINX.RESPONSE_TIME.MAX.WARN}s for 5m)'
               priority: WARNING
               manual_close: 'YES'
               dependencies:
                 - name: 'Nginx: Service is down'
-                  expression: 'last(/Nginx by HTTP/net.tcp.service[http,"{HOST.CONN}","{$NGINX.STUB_STATUS.PORT}"])=0'
+                  expression: 'last(/Nginx by HTTP/net.tcp.service[http,"{$NGINX.STUB_STATUS.HOST}","{$NGINX.STUB_STATUS.PORT}"])=0'
               tags:
                 - tag: scope
                   value: performance
         - uuid: e4a09193bc8f42f2888ece83f89f84af
           name: 'Nginx: Service status'
           type: SIMPLE
-          key: 'net.tcp.service[http,"{HOST.CONN}","{$NGINX.STUB_STATUS.PORT}"]'
+          key: 'net.tcp.service[http,"{$NGINX.STUB_STATUS.HOST}","{$NGINX.STUB_STATUS.PORT}"]'
           history: 7d
           valuemap:
             name: 'Service state'
@@ -63,7 +70,7 @@
               value: health
           triggers:
             - uuid: 7b3de87ba0ea425280d42235bb626b8b
-              expression: 'last(/Nginx by HTTP/net.tcp.service[http,"{HOST.CONN}","{$NGINX.STUB_STATUS.PORT}"])=0'
+              expression: 'last(/Nginx by HTTP/net.tcp.service[http,"{$NGINX.STUB_STATUS.HOST}","{$NGINX.STUB_STATUS.PORT}"])=0'
               name: 'Nginx: Service is down'
               priority: AVERAGE
               manual_close: 'YES'
@@ -142,7 +149,7 @@
               description: 'The rate of dropping connections has been greater than {$NGINX.DROP_RATE.MAX.WARN} for the last 5 minutes.'
               dependencies:
                 - name: 'Nginx: Service is down'
-                  expression: 'last(/Nginx by HTTP/net.tcp.service[http,"{HOST.CONN}","{$NGINX.STUB_STATUS.PORT}"])=0'
+                  expression: 'last(/Nginx by HTTP/net.tcp.service[http,"{$NGINX.STUB_STATUS.HOST}","{$NGINX.STUB_STATUS.PORT}"])=0'
               tags:
                 - tag: scope
                   value: performance
@@ -236,7 +243,7 @@
             `Waiting` - the current number of idle client connections waiting for a request.
             
             See also [Module ngx_http_stub_status_module](https://nginx.org/en/docs/http/ngx_http_stub_status_module.html).
-          url: '{$NGINX.STUB_STATUS.SCHEME}://{HOST.CONN}:{$NGINX.STUB_STATUS.PORT}/{$NGINX.STUB_STATUS.PATH}'
+          url: '{$NGINX.STUB_STATUS.SCHEME}://{$NGINX.STUB_STATUS.HOST}:{$NGINX.STUB_STATUS.PORT}/{$NGINX.STUB_STATUS.PATH}'
           retrieve_mode: BOTH
           tags:
             - tag: component
@@ -255,7 +262,7 @@
               manual_close: 'YES'
               dependencies:
                 - name: 'Nginx: Service is down'
-                  expression: 'last(/Nginx by HTTP/net.tcp.service[http,"{HOST.CONN}","{$NGINX.STUB_STATUS.PORT}"])=0'
+                  expression: 'last(/Nginx by HTTP/net.tcp.service[http,"{$NGINX.STUB_STATUS.HOST}","{$NGINX.STUB_STATUS.PORT}"])=0'
               tags:
                 - tag: scope
                   value: availability
@@ -341,6 +348,9 @@
         - macro: '{$NGINX.RESPONSE_TIME.MAX.WARN}'
           value: '10'
           description: 'The maximum response time of Nginx expressed in seconds for a trigger expression.'
+        - macro: '{$NGINX.STUB_STATUS.HOST}'
+          value: 127.0.0.1
+          description: 'Hostname or IP of Nginx HTTP server'
         - macro: '{$NGINX.STUB_STATUS.PATH}'
           value: basic_status
           description: 'The path of the `Nginx stub_status` page.'


```
